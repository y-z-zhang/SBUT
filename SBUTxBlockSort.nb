(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    108002,       2565]
NotebookOptionsPosition[    102005,       2472]
NotebookOutlinePosition[    102441,       2489]
CellTagsIndexPosition[    102398,       2486]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Directed network with n clusters, each with m nodes", "Section",
 CellChangeTimes->{{3.799414501327322*^9, 3.799414569685688*^9}, {
   3.799431102115837*^9, 3.799431123371296*^9}, {3.7994315390384417`*^9, 
   3.799431548299197*^9}, {3.79943332988188*^9, 3.7994333369940434`*^9}, 
   3.799434337562872*^9, {3.806016894907633*^9, 3.806016911399619*^9}},
 Background->RGBColor[
  0.94, 0.88, 0.94],ExpressionUUID->"b14695c3-84f4-43e2-aeec-40e5aa2c7e44"],

Cell[TextData[{
 "Laplacian matrix ",
 StyleBox["L", "Code"],
 " representing network structure and diagonal matrices ",
 StyleBox["Mats", "Code"],
 " encoding clusters"
}], "Text",
 CellChangeTimes->{{3.799414612727726*^9, 3.799414619446245*^9}, {
   3.799415066406357*^9, 3.79941516513525*^9}, 3.799432474097878*^9, {
   3.7994333529107847`*^9, 3.799433355712551*^9}, {3.8060169223716803`*^9, 
   3.806016969732583*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"019e6f98-1242-48cf-b104-bcc99ba00625"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"L", "=", 
   RowBox[{"Import", "[", 
    RowBox[{
    "\"\</Users/Yuanzhao/Downloads/Fiona/lap.txt\>\"", ",", "\"\<Table\>\"", 
     ",", 
     RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<,\>\""}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"n", " ", "=", " ", "5"}], ";", " ", 
  RowBox[{"m", " ", "=", "5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Mats", " ", "=", " ", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", 
       RowBox[{"n", "*", "m"}], ",", 
       RowBox[{"n", "*", "m"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", 
   RowBox[{"i", "<", 
    RowBox[{"n", "+", "1"}]}], ",", 
   RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
   RowBox[{"For", "[", 
    RowBox[{
     RowBox[{"j", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"i", "-", "1"}], ")"}], "*", "m"}], "+", "1"}]}], ",", 
     RowBox[{"j", "<", 
      RowBox[{
       RowBox[{"i", "*", "m"}], "+", "1"}]}], ",", 
     RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Mats", "[", 
        RowBox[{"[", 
         RowBox[{"i", ",", "j", ",", "j"}], "]"}], "]"}], "=", "1"}], ";"}]}],
     "\[IndentingNewLine]", "]"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.799414669182939*^9, 3.799414841925218*^9}, {
  3.799414890057472*^9, 3.799414894962132*^9}, {3.799414925631233*^9, 
  3.799414977467211*^9}, {3.799415187035104*^9, 3.799415227321734*^9}, {
  3.799427966880003*^9, 3.7994280126530237`*^9}, {3.7994309291885643`*^9, 
  3.799430985340529*^9}, {3.799433368077129*^9, 3.7994334882064943`*^9}, {
  3.805996897920588*^9, 3.805996937983144*^9}, {3.8059969836521072`*^9, 
  3.805997217336711*^9}, {3.80599725479739*^9, 3.805997263828609*^9}, {
  3.806016988136477*^9, 3.806017028315373*^9}},
 CellLabel->"In[56]:=",ExpressionUUID->"f736de18-8d23-4497-be34-292099b6b283"],

Cell[TextData[{
 "Generate a random combination ",
 StyleBox["M", "Code"],
 " of all generating matrices so we don\[CloseCurlyQuote]t have to worry \
about degeneracy (or use the form suggested in the paper for better alignment \
with clusters)"
}], "Text",
 CellChangeTimes->{{3.79941527009396*^9, 3.799415271078031*^9}, {
  3.79941530937466*^9, 3.799415378806513*^9}, {3.799415525186016*^9, 
  3.799415568046137*^9}, {3.799415947907683*^9, 3.799415948232992*^9}, {
  3.799416031877707*^9, 3.799416043254402*^9}, {3.799431563724298*^9, 
  3.799431618460472*^9}, {3.7994316839605618`*^9, 3.799431705539885*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"0567de38-d01a-4628-ab11-d9f3dfbde1ca"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"M", " ", "=", "L"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", 
   RowBox[{"i", "<", 
    RowBox[{"n", "+", "1"}]}], ",", 
   RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"M", " ", "=", " ", 
      RowBox[{"M", " ", "+", " ", 
       RowBox[{
        RowBox[{"RandomInteger", "[", 
         RowBox[{"{", 
          RowBox[{"1", ",", "10"}], "}"}], "]"}], "*", 
        RowBox[{
         RowBox[{"Mats", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ".", "L", ".", 
         RowBox[{"Mats", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}]}]}]}], ";"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"M", " ", "=", " ", 
    RowBox[{"M", " ", "+", " ", 
     RowBox[{
      RowBox[{"RandomInteger", "[", 
       RowBox[{"{", 
        RowBox[{"1", ",", "10"}], "}"}], "]"}], "*", 
      RowBox[{"Mats", "[", 
       RowBox[{"[", "i", "]"}], "]"}]}]}]}]}], "\[IndentingNewLine]", 
  "]"}]}], "Input",
 CellChangeTimes->{{3.799415790153862*^9, 3.7994158483728867`*^9}, {
  3.7994158799116793`*^9, 3.7994159030968924`*^9}, {3.7994298601023207`*^9, 
  3.799429867068618*^9}, {3.7994299657312937`*^9, 3.799429972584841*^9}, {
  3.799430040407251*^9, 3.799430041148488*^9}, {3.799430502221736*^9, 
  3.799430561484057*^9}, {3.799430613559917*^9, 3.799430616105988*^9}, {
  3.799430748437825*^9, 3.7994307690038147`*^9}, {3.799430799966216*^9, 
  3.79943081574116*^9}, {3.7994317185900917`*^9, 3.799431720482313*^9}, {
  3.799432681155864*^9, 3.799432684091465*^9}, {3.799433221719895*^9, 
  3.799433259979487*^9}, {3.7994335155628777`*^9, 3.799433541045506*^9}, {
  3.799435479526174*^9, 3.799435481018751*^9}, {3.8059972913066196`*^9, 
  3.8059973943388643`*^9}, {3.806017056482831*^9, 3.806017058297287*^9}, {
  3.806022140476203*^9, 3.80602216810609*^9}},
 CellLabel->"In[60]:=",ExpressionUUID->"8d7b3585-57b4-4620-a4ea-661b47209a83"],

Cell[TextData[{
 "Find the basis for the common block upper triangular form by finding the \
Jordan decomposition of ",
 StyleBox["M", "Code"]
}], "Text",
 CellChangeTimes->{{3.79941527009396*^9, 3.799415271078031*^9}, {
  3.79941530937466*^9, 3.799415378806513*^9}, {3.799415525186016*^9, 
  3.799415568046137*^9}, {3.799415947907683*^9, 3.799415948232992*^9}, {
  3.799416031877707*^9, 3.799416043254402*^9}, {3.799416111423686*^9, 
  3.799416163394915*^9}, {3.799432434311125*^9, 3.799432434546299*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"35d57b21-5d0b-408c-a3db-e8f116cbc832"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"s", ",", "j"}], "}"}], " ", "=", " ", 
   RowBox[{"JordanDecomposition", "[", "M", "]"}]}], " ", ";"}]], "Input",
 CellChangeTimes->{{3.799415790153862*^9, 3.7994158483728867`*^9}, {
   3.7994158799116793`*^9, 3.7994159030968924`*^9}, {3.799416205956647*^9, 
   3.799416240175399*^9}, {3.7994163066010237`*^9, 3.7994163101111383`*^9}, 
   3.799431780099538*^9},
 CellLabel->"In[62]:=",ExpressionUUID->"8f8fd358-2279-4f0e-a79d-a2a07b5c1b32"],

Cell[TextData[{
 "Find the form of ",
 StyleBox["L", "Code"],
 " under the similarity transformation ",
 StyleBox["s", "Code"]
}], "Text",
 CellChangeTimes->{{3.799431828189337*^9, 3.799431871732072*^9}, {
  3.7994321142424173`*^9, 3.799432167196562*^9}, {3.7994326963978643`*^9, 
  3.7994327079245*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"c6406de8-e728-4cde-87b7-65351aa11fc0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"s", " ", "=", " ", 
   RowBox[{"N", "[", "s", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"S", " ", "=", " ", 
   RowBox[{"Inverse", "[", "s", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"TempL", " ", "=", " ", 
   RowBox[{"S", ".", "L", ".", "s"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7994176335202227`*^9, 3.799417641775072*^9}, {
   3.7994176872029943`*^9, 3.799417703831483*^9}, {3.7994282087096252`*^9, 
   3.7994282726043577`*^9}, {3.799428362806028*^9, 3.799428366312415*^9}, {
   3.799428415961931*^9, 3.799428418858419*^9}, {3.799428473672982*^9, 
   3.799428516387446*^9}, {3.799428592814047*^9, 3.799428600471874*^9}, {
   3.799429341468964*^9, 3.799429342052362*^9}, {3.799429470008029*^9, 
   3.799429487535706*^9}, {3.799431820837278*^9, 3.799431825290606*^9}, {
   3.799432125932681*^9, 3.799432127813827*^9}, 3.8060225522101383`*^9},
 CellLabel->"In[63]:=",ExpressionUUID->"8d44f100-c810-4b4f-b454-6ac6c6126bc6"],

Cell[TextData[{
 "Use the BlockSort algorithm to reorder the basis ",
 StyleBox["s", "Code"],
 " so that it can be used to reveal the common block upper triangular form"
}], "Text",
 CellChangeTimes->{{3.799432182618843*^9, 3.799432205300385*^9}, {
   3.799432251560223*^9, 3.7994322740190773`*^9}, {3.79943230668435*^9, 
   3.799432316467209*^9}, {3.7994323688085213`*^9, 3.799432409009536*^9}, {
   3.79943271163017*^9, 3.799432745797324*^9}, {3.799433968167728*^9, 
   3.799433969723502*^9}, 3.799490357884177*^9},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"a2074505-58ee-43fb-b7c8-6c807a0eac71"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"TempL", " ", "=", " ", 
   RowBox[{"Round", "[", 
    RowBox[{
     RowBox[{"N", "[", "TempL", "]"}], ",", 
     RowBox[{"10", "^", 
      RowBox[{"-", "5"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"order", "=", 
  RowBox[{"BlockSort", "[", "TempL", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BlockSize", " ", "=", " ", 
   RowBox[{"Map", "[", 
    RowBox[{"Length", ",", "order"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Reduction", " ", "=", " ", 
  RowBox[{"N", "[", 
   RowBox[{
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{"i", "^", "3"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "BlockSize"}], "}"}]}], "]"}], "/", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"n", "*", "m"}], ")"}], "^", "3"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"order", " ", "=", " ", 
   RowBox[{"Flatten", "[", "order", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"s", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "All"}], "]"}], "]"}], "=", 
     RowBox[{"s", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "order"}], "]"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"s", "//", "MatrixForm"}]}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.799428707029374*^9, 3.79942871899384*^9}, {
   3.799429178478023*^9, 3.799429287893588*^9}, {3.79942980670231*^9, 
   3.7994298264554367`*^9}, {3.799431063743132*^9, 3.799431081540015*^9}, {
   3.79943398833*^9, 3.79943404414145*^9}, {3.799434154644354*^9, 
   3.799434156887411*^9}, {3.799434230422418*^9, 3.799434264272257*^9}, {
   3.7994902872392063`*^9, 3.799490294050302*^9}, 3.8059994432768497`*^9, {
   3.805999535078313*^9, 3.805999563705823*^9}, {3.805999717795754*^9, 
   3.805999823266225*^9}, {3.806000673998034*^9, 3.8060006772325897`*^9}, {
   3.806000831091058*^9, 3.806000871206112*^9}, {3.80601709688381*^9, 
   3.8060171008071136`*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"11d0baaa-711c-49e4-81fb-7a1355e1baf3"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", "1", "}"}], ",", 
   RowBox[{"{", "10", "}"}], ",", 
   RowBox[{"{", "17", "}"}], ",", 
   RowBox[{"{", "16", "}"}], ",", 
   RowBox[{"{", "2", "}"}], ",", 
   RowBox[{"{", "3", "}"}], ",", 
   RowBox[{"{", "4", "}"}], ",", 
   RowBox[{"{", "5", "}"}], ",", 
   RowBox[{"{", "7", "}"}], ",", 
   RowBox[{"{", "6", "}"}], ",", 
   RowBox[{"{", "8", "}"}], ",", 
   RowBox[{"{", "9", "}"}], ",", 
   RowBox[{"{", "11", "}"}], ",", 
   RowBox[{"{", "12", "}"}], ",", 
   RowBox[{"{", "13", "}"}], ",", 
   RowBox[{"{", "14", "}"}], ",", 
   RowBox[{"{", "15", "}"}], ",", 
   RowBox[{"{", "18", "}"}], ",", 
   RowBox[{"{", "19", "}"}], ",", 
   RowBox[{"{", "20", "}"}], ",", 
   RowBox[{"{", "21", "}"}], ",", 
   RowBox[{"{", "22", "}"}], ",", 
   RowBox[{"{", "23", "}"}], ",", 
   RowBox[{"{", "24", "}"}], ",", 
   RowBox[{"{", "25", "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8060224768702707`*^9, 3.806022600931541*^9, 
  3.806022673880767*^9},
 CellLabel->"Out[67]=",ExpressionUUID->"93a51eee-b6de-4023-8ffb-c1ba0f3687bc"],

Cell[BoxData["0.0016`"], "Output",
 CellChangeTimes->{3.8060224768702707`*^9, 3.806022600931541*^9, 
  3.806022673883081*^9},
 CellLabel->"Out[69]=",ExpressionUUID->"ca6b694c-782d-4324-aca1-babcdffe261a"]
}, Open  ]],

Cell["The final common block upper triangular form", "Text",
 CellChangeTimes->{{3.799432797289091*^9, 3.799432805587009*^9}, {
  3.7994329130829353`*^9, 3.799432918319117*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"0c0e6b6d-0206-4037-a316-923761877104"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"FinalL", " ", "=", " ", 
  RowBox[{
   RowBox[{"TempL", "[", 
    RowBox[{"[", 
     RowBox[{"order", ",", "order"}], "]"}], "]"}], "//", 
   "MatrixForm"}]}]], "Input",
 CellChangeTimes->{{3.7994296030779743`*^9, 3.7994296124863853`*^9}, 
   3.799432772696725*^9, {3.7994903080754557`*^9, 3.7994903211661463`*^9}, {
   3.805998971962174*^9, 3.805998980169814*^9}, {3.805999055215107*^9, 
   3.805999055526166*^9}, {3.805999130129156*^9, 3.8059991303988457`*^9}, {
   3.805999284375021*^9, 3.805999289253984*^9}, {3.806000411919701*^9, 
   3.806000413705654*^9}, {3.806000878548868*^9, 3.806000879778058*^9}, {
   3.806000942817115*^9, 3.806000945912126*^9}},
 CellLabel->"In[71]:=",ExpressionUUID->"6cc598a1-9eb4-4240-b75a-8f13b4a6cce3"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"5", "0", "0", "0", "1", "0", "0", "0", 
      RowBox[{"-", "302500"}], 
      FractionBox["424772727", "100000"], "453750", 
      RowBox[{"-", "273325"}], 
      RowBox[{"-", 
       FractionBox["37037", "25000"]}], "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", "0", "0"},
     {"0", "5", 
      RowBox[{"-", "5"}], 
      RowBox[{"-", "110"}], 
      FractionBox["6319", "100000"], "0", "0", "0", 
      RowBox[{"-", "156750"}], 
      FractionBox["6878422", "3125"], 
      RowBox[{"-", "92900"}], 
      RowBox[{"-", "42195"}], 
      FractionBox["78889", "50000"], "0", "0", "0", "0", 
      RowBox[{"-", "5"}], "10", 
      RowBox[{"-", "5"}], 
      RowBox[{"-", "5"}], 
      RowBox[{"-", 
       FractionBox["454871", "100000"]}], 
      RowBox[{"-", 
       FractionBox["481787", "100000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["466671", "100000"]}], "+", 
       FractionBox[
        RowBox[{"1677", " ", "\[ImaginaryI]"}], "25000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["466671", "100000"]}], "-", 
       FractionBox[
        RowBox[{"1677", " ", "\[ImaginaryI]"}], "25000"]}]},
     {"0", "0", "10", 
      RowBox[{"-", "10"}], 
      RowBox[{"-", 
       FractionBox["63", "800"]}], "0", "0", "0", 
      FractionBox["1283333333", "100000"], 
      RowBox[{"-", 
       FractionBox["18020661", "100000"]}], 
      RowBox[{"-", 
       FractionBox["1056666667", "100000"]}], "130", 
      FractionBox["11481", "100000"], "0", "0", "0", "0", "0", "0", "0", "0", 
      
      RowBox[{"-", 
       FractionBox["54871", "100000"]}], 
      RowBox[{"-", 
       FractionBox["81787", "100000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["66671", "100000"]}], "+", 
       FractionBox[
        RowBox[{"1677", " ", "\[ImaginaryI]"}], "25000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["66671", "100000"]}], "-", 
       FractionBox[
        RowBox[{"1677", " ", "\[ImaginaryI]"}], "25000"]}]},
     {"0", "0", "0", "5", 
      RowBox[{"-", 
       FractionBox["119", "10000"]}], "0", "0", "0", 
      FractionBox["201666667", "100000"], 
      RowBox[{"-", 
       FractionBox["1415909", "50000"]}], 
      RowBox[{"-", 
       FractionBox["161333333", "100000"]}], 
      RowBox[{"-", "13"}], 
      FractionBox["463", "25000"], "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "6", "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "6", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "7", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "2", 
      FractionBox["7021", "100000"], "1", 
      FractionBox["264527", "50000"], "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "7", "0", 
      FractionBox["18838189", "50000"], "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "2", "1", "0", "0", 
      "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "2", "0", "0", 
      "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "3", "0", 
      "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "6", 
      "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      "8", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "8", "1", "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "8", "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", "12", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", "0", "13", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", "0", "0", 
      FractionBox["1038197", "100000"], "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", "0", "0", "0", 
      FractionBox["1261803", "100000"], "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", "0", "0", "0", "0", 
      FractionBox["81089", "12500"], "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", "0", "0", "0", "0", "0", 
      FractionBox["57367", "6250"], "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      RowBox[{
       FractionBox["191677", "25000"], "-", 
       FractionBox[
        RowBox[{"67077", " ", "\[ImaginaryI]"}], "100000"]}], "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      RowBox[{
       FractionBox["191677", "25000"], "+", 
       FractionBox[
        RowBox[{"67077", " ", "\[ImaginaryI]"}], "100000"]}]}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.806022476984807*^9, 3.806022600956952*^9, 
  3.80602267389953*^9},
 CellLabel->
  "Out[71]//MatrixForm=",ExpressionUUID->"c5daa7e8-1367-4e2f-8d67-\
93d48fa48911"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Ring network with n nodes and m alternating clusters", "Section",
 CellChangeTimes->{{3.799414501327322*^9, 3.799414569685688*^9}, {
   3.799431102115837*^9, 3.799431123371296*^9}, {3.7994315390384417`*^9, 
   3.799431548299197*^9}, {3.79943332988188*^9, 3.7994333369940434`*^9}, 
   3.799434337562872*^9, {3.806016894907633*^9, 3.806016911399619*^9}, {
   3.806018761490292*^9, 3.8060187752153807`*^9}},
 Background->RGBColor[
  0.94, 0.88, 0.94],ExpressionUUID->"e3db3499-eea8-4db4-b577-af3791cbd82a"],

Cell[TextData[{
 "Laplacian matrix ",
 StyleBox["L", "Code"],
 " representing network structure and diagonal matrices ",
 StyleBox["Mats", "Code"],
 " encoding clusters"
}], "Text",
 CellChangeTimes->{{3.799414612727726*^9, 3.799414619446245*^9}, {
   3.799415066406357*^9, 3.79941516513525*^9}, 3.799432474097878*^9, {
   3.7994333529107847`*^9, 3.799433355712551*^9}, {3.8060169223716803`*^9, 
   3.806016969732583*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"d2c16f27-7a39-4153-8c47-cf7bde789b85"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"L", "=", 
   RowBox[{"Import", "[", 
    RowBox[{
    "\"\</Users/Yuanzhao/Downloads/Fiona/lap.txt\>\"", ",", "\"\<Table\>\"", 
     ",", 
     RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<,\>\""}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"n", " ", "=", " ", "20"}], ";", " ", 
  RowBox[{"m", " ", "=", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Mats", " ", "=", " ", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", 
     RowBox[{"{", 
      RowBox[{"m", ",", "n", ",", "n"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", 
   RowBox[{"i", "<", 
    RowBox[{"m", "+", "1"}]}], ",", 
   RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
   RowBox[{"For", "[", 
    RowBox[{
     RowBox[{"j", "=", "i"}], ",", 
     RowBox[{"j", "<", 
      RowBox[{"n", "+", "1"}]}], ",", 
     RowBox[{"j", "=", 
      RowBox[{"j", "+", "m"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Mats", "[", 
        RowBox[{"[", 
         RowBox[{"i", ",", "j", ",", "j"}], "]"}], "]"}], "=", "1"}], ";"}]}],
     "\[IndentingNewLine]", "]"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.799414669182939*^9, 3.799414841925218*^9}, {
  3.799414890057472*^9, 3.799414894962132*^9}, {3.799414925631233*^9, 
  3.799414977467211*^9}, {3.799415187035104*^9, 3.799415227321734*^9}, {
  3.799427966880003*^9, 3.7994280126530237`*^9}, {3.7994309291885643`*^9, 
  3.799430985340529*^9}, {3.799433368077129*^9, 3.7994334882064943`*^9}, {
  3.805996897920588*^9, 3.805996937983144*^9}, {3.8059969836521072`*^9, 
  3.805997217336711*^9}, {3.80599725479739*^9, 3.805997263828609*^9}, {
  3.806016988136477*^9, 3.806017028315373*^9}, {3.8060187999977283`*^9, 
  3.806018813816971*^9}, {3.806018928944128*^9, 3.806019003368638*^9}, {
  3.806019143097292*^9, 3.806019166770576*^9}, {3.806021080332046*^9, 
  3.806021082416904*^9}, {3.8061943748592577`*^9, 3.806194377390316*^9}},
 CellLabel->
  "In[104]:=",ExpressionUUID->"f0844fc7-f920-430a-9d72-6786342ada54"],

Cell[TextData[{
 "Generate a random combination ",
 StyleBox["M", "Code"],
 " of all generating matrices so we don\[CloseCurlyQuote]t have to worry \
about degeneracy (or use the form suggested in the paper for better alignment \
with clusters)"
}], "Text",
 CellChangeTimes->{{3.79941527009396*^9, 3.799415271078031*^9}, {
  3.79941530937466*^9, 3.799415378806513*^9}, {3.799415525186016*^9, 
  3.799415568046137*^9}, {3.799415947907683*^9, 3.799415948232992*^9}, {
  3.799416031877707*^9, 3.799416043254402*^9}, {3.799431563724298*^9, 
  3.799431618460472*^9}, {3.7994316839605618`*^9, 3.799431705539885*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"323d886e-6161-4e48-9460-f8b1272bfbe8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"M", " ", "=", "L"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", 
   RowBox[{"i", "<", 
    RowBox[{"m", "+", "1"}]}], ",", 
   RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"M", " ", "=", " ", 
      RowBox[{"M", " ", "+", " ", 
       RowBox[{
        RowBox[{"RandomInteger", "[", 
         RowBox[{"{", 
          RowBox[{"1", ",", "10"}], "}"}], "]"}], "*", 
        RowBox[{
         RowBox[{"Mats", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ".", "L", ".", 
         RowBox[{"Mats", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}]}]}]}], ";"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"M", " ", "=", " ", 
    RowBox[{"M", " ", "+", " ", 
     RowBox[{
      RowBox[{"RandomInteger", "[", 
       RowBox[{"{", 
        RowBox[{"1", ",", "10"}], "}"}], "]"}], "*", 
      RowBox[{"Mats", "[", 
       RowBox[{"[", "i", "]"}], "]"}]}]}]}]}], "\[IndentingNewLine]", 
  "]"}]}], "Input",
 CellChangeTimes->{{3.799415790153862*^9, 3.7994158483728867`*^9}, {
  3.7994158799116793`*^9, 3.7994159030968924`*^9}, {3.7994298601023207`*^9, 
  3.799429867068618*^9}, {3.7994299657312937`*^9, 3.799429972584841*^9}, {
  3.799430040407251*^9, 3.799430041148488*^9}, {3.799430502221736*^9, 
  3.799430561484057*^9}, {3.799430613559917*^9, 3.799430616105988*^9}, {
  3.799430748437825*^9, 3.7994307690038147`*^9}, {3.799430799966216*^9, 
  3.79943081574116*^9}, {3.7994317185900917`*^9, 3.799431720482313*^9}, {
  3.799432681155864*^9, 3.799432684091465*^9}, {3.799433221719895*^9, 
  3.799433259979487*^9}, {3.7994335155628777`*^9, 3.799433541045506*^9}, {
  3.799435479526174*^9, 3.799435481018751*^9}, {3.8059972913066196`*^9, 
  3.8059973943388643`*^9}, {3.806017056482831*^9, 3.806017058297287*^9}, {
  3.806019175614544*^9, 3.80601917760005*^9}, {3.806019331229927*^9, 
  3.806019360661188*^9}},
 CellLabel->
  "In[108]:=",ExpressionUUID->"4e113dd1-dcee-4f64-af57-a137b716b7f4"],

Cell[TextData[{
 "Find the basis for the common block upper triangular form by finding the \
Jordan decomposition of ",
 StyleBox["M", "Code"]
}], "Text",
 CellChangeTimes->{{3.79941527009396*^9, 3.799415271078031*^9}, {
  3.79941530937466*^9, 3.799415378806513*^9}, {3.799415525186016*^9, 
  3.799415568046137*^9}, {3.799415947907683*^9, 3.799415948232992*^9}, {
  3.799416031877707*^9, 3.799416043254402*^9}, {3.799416111423686*^9, 
  3.799416163394915*^9}, {3.799432434311125*^9, 3.799432434546299*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"59606216-50d9-4859-beb3-955592c98614"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"s", ",", "j"}], "}"}], " ", "=", " ", 
   RowBox[{"JordanDecomposition", "[", "M", "]"}]}], " ", ";"}]], "Input",
 CellChangeTimes->{{3.799415790153862*^9, 3.7994158483728867`*^9}, {
   3.7994158799116793`*^9, 3.7994159030968924`*^9}, {3.799416205956647*^9, 
   3.799416240175399*^9}, {3.7994163066010237`*^9, 3.7994163101111383`*^9}, 
   3.799431780099538*^9},
 CellLabel->
  "In[110]:=",ExpressionUUID->"b2562852-d057-4703-a38a-6999bd692d37"],

Cell[TextData[{
 "Find the form of ",
 StyleBox["L", "Code"],
 " under the similarity transformation ",
 StyleBox["s", "Code"]
}], "Text",
 CellChangeTimes->{{3.799431828189337*^9, 3.799431871732072*^9}, {
  3.7994321142424173`*^9, 3.799432167196562*^9}, {3.7994326963978643`*^9, 
  3.7994327079245*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"8d219f48-6692-4ab9-803b-ad982d32a39d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"s", " ", "=", " ", 
   RowBox[{"N", "[", "s", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"S", " ", "=", " ", 
   RowBox[{"Inverse", "[", "s", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"TempL", " ", "=", " ", 
   RowBox[{"S", ".", "L", ".", "s"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7994176335202227`*^9, 3.799417641775072*^9}, {
  3.7994176872029943`*^9, 3.799417703831483*^9}, {3.7994282087096252`*^9, 
  3.7994282726043577`*^9}, {3.799428362806028*^9, 3.799428366312415*^9}, {
  3.799428415961931*^9, 3.799428418858419*^9}, {3.799428473672982*^9, 
  3.799428516387446*^9}, {3.799428592814047*^9, 3.799428600471874*^9}, {
  3.799429341468964*^9, 3.799429342052362*^9}, {3.799429470008029*^9, 
  3.799429487535706*^9}, {3.799431820837278*^9, 3.799431825290606*^9}, {
  3.799432125932681*^9, 3.799432127813827*^9}, {3.806020942199155*^9, 
  3.806020953028393*^9}},
 CellLabel->
  "In[111]:=",ExpressionUUID->"9341c732-b168-4f03-9b6d-f6457d7adb06"],

Cell[TextData[{
 "Use the BlockSort algorithm to reorder the basis ",
 StyleBox["s", "Code"],
 " so that it can be used to reveal the common block upper triangular form"
}], "Text",
 CellChangeTimes->{{3.799432182618843*^9, 3.799432205300385*^9}, {
   3.799432251560223*^9, 3.7994322740190773`*^9}, {3.79943230668435*^9, 
   3.799432316467209*^9}, {3.7994323688085213`*^9, 3.799432409009536*^9}, {
   3.79943271163017*^9, 3.799432745797324*^9}, {3.799433968167728*^9, 
   3.799433969723502*^9}, 3.799490357884177*^9},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"cbfb22ff-8b87-4457-ad9a-b32db2b0c6f7"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"TempL", " ", "=", " ", 
   RowBox[{"Round", "[", 
    RowBox[{
     RowBox[{"N", "[", "TempL", "]"}], ",", 
     RowBox[{"10", "^", 
      RowBox[{"-", "5"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"order", "=", 
  RowBox[{"BlockSort", "[", "TempL", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BlockSize", " ", "=", " ", 
   RowBox[{"Map", "[", 
    RowBox[{"Length", ",", "order"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Reduction", " ", "=", " ", 
  RowBox[{"N", "[", 
   RowBox[{
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{"i", "^", "3"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "BlockSize"}], "}"}]}], "]"}], "/", 
    RowBox[{"n", "^", "3"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"order", " ", "=", " ", 
   RowBox[{"Flatten", "[", "order", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"s", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "All"}], "]"}], "]"}], "=", 
     RowBox[{"s", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "order"}], "]"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"s", "//", "MatrixForm"}]}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.799428707029374*^9, 3.79942871899384*^9}, {
   3.799429178478023*^9, 3.799429287893588*^9}, {3.79942980670231*^9, 
   3.7994298264554367`*^9}, {3.799431063743132*^9, 3.799431081540015*^9}, {
   3.79943398833*^9, 3.79943404414145*^9}, {3.799434154644354*^9, 
   3.799434156887411*^9}, {3.799434230422418*^9, 3.799434264272257*^9}, {
   3.7994902872392063`*^9, 3.799490294050302*^9}, 3.8059994432768497`*^9, {
   3.805999535078313*^9, 3.805999563705823*^9}, {3.805999717795754*^9, 
   3.805999823266225*^9}, {3.806000673998034*^9, 3.8060006772325897`*^9}, {
   3.806000831091058*^9, 3.806000871206112*^9}, {3.80601709688381*^9, 
   3.8060171008071136`*^9}, {3.806019201518547*^9, 3.806019202872513*^9}},
 CellLabel->
  "In[114]:=",ExpressionUUID->"d657c612-4ff4-4148-a93f-0b4bf1bf3a8d"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", "2", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"5", ",", "12", ",", "16", ",", "20"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"6", ",", "11", ",", "15", ",", "19"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"7", ",", "10", ",", "14", ",", "18"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"8", ",", "9", ",", "13", ",", "17"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "3", ",", "4"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8061940983852463`*^9, 3.806194391632635*^9, 
  3.806194570449568*^9},
 CellLabel->
  "Out[115]=",ExpressionUUID->"4566257a-f89d-418d-a1f8-2c8a4ba8a192"],

Cell[BoxData["0.0355`"], "Output",
 CellChangeTimes->{3.8061940983852463`*^9, 3.806194391632635*^9, 
  3.806194570451808*^9},
 CellLabel->
  "Out[117]=",ExpressionUUID->"0a12e9d8-2649-48af-983d-8022ffc2e94c"]
}, Open  ]],

Cell["The final common block upper triangular form", "Text",
 CellChangeTimes->{{3.799432797289091*^9, 3.799432805587009*^9}, {
  3.7994329130829353`*^9, 3.799432918319117*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"7f4ba8ab-b09e-42a0-8beb-1f3ddb709987"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"FinalL", " ", "=", " ", 
  RowBox[{
   RowBox[{"TempL", "[", 
    RowBox[{"[", 
     RowBox[{"order", ",", "order"}], "]"}], "]"}], "//", 
   "MatrixForm"}]}]], "Input",
 CellChangeTimes->{{3.7994296030779743`*^9, 3.7994296124863853`*^9}, 
   3.799432772696725*^9, {3.7994903080754557`*^9, 3.7994903211661463`*^9}, {
   3.805998971962174*^9, 3.805998980169814*^9}, {3.805999055215107*^9, 
   3.805999055526166*^9}, {3.805999130129156*^9, 3.8059991303988457`*^9}, {
   3.805999284375021*^9, 3.805999289253984*^9}, {3.806000411919701*^9, 
   3.806000413705654*^9}, {3.806000878548868*^9, 3.806000879778058*^9}, {
   3.806000942817115*^9, 3.806000945912126*^9}},
 CellLabel->
  "In[119]:=",ExpressionUUID->"3a70a6ed-e719-47f7-9b73-ac7ebc3928db"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"4", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", 
      FractionBox["1", "100000"], "0", "0"},
     {"0", 
      RowBox[{
       FractionBox["42937", "50000"], "-", 
       FractionBox[
        RowBox[{"45013", " ", "\[ImaginaryI]"}], "25000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["53281", "100000"]}], "+", 
       FractionBox[
        RowBox[{"16953", " ", "\[ImaginaryI]"}], "12500"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["1427", "3125"]}], "+", 
       FractionBox[
        RowBox[{"5253", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["4107", "20000"]}], "-", 
       FractionBox[
        RowBox[{"14753", " ", "\[ImaginaryI]"}], "100000"]}], "0", "0", "0", 
      "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      RowBox[{"-", 
       FractionBox["\[ImaginaryI]", "100000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["1", "50000"]}], "+", 
       FractionBox["\[ImaginaryI]", "20000"]}], "0"},
     {"0", 
      RowBox[{
       RowBox[{"-", 
        FractionBox["989", "10000"]}], "-", 
       FractionBox[
        RowBox[{"2957", " ", "\[ImaginaryI]"}], "20000"]}], 
      RowBox[{
       FractionBox["351087", "100000"], "+", 
       FractionBox[
        RowBox[{"323", " ", "\[ImaginaryI]"}], "1000"]}], 
      RowBox[{
       FractionBox["3313", "100000"], "+", 
       FractionBox[
        RowBox[{"4581", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["4789", "100000"]}], "-", 
       FractionBox[
        RowBox[{"2413", " ", "\[ImaginaryI]"}], "100000"]}], "0", "0", "0", 
      "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", 
      RowBox[{
       RowBox[{"-", 
        FractionBox["5977", "50000"]}], "-", 
       FractionBox[
        RowBox[{"22599", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       FractionBox["12523", "25000"], "-", 
       FractionBox[
        RowBox[{"13339", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       FractionBox["194807", "50000"], "+", 
       FractionBox[
        RowBox[{"5899", " ", "\[ImaginaryI]"}], "10000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["5233", "100000"]}], "-", 
       FractionBox[
        RowBox[{"979", " ", "\[ImaginaryI]"}], "10000"]}], "0", "0", "0", "0",
       "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      RowBox[{"-", 
       FractionBox["\[ImaginaryI]", "100000"]}], "0"},
     {"0", 
      RowBox[{
       RowBox[{"-", 
        FractionBox["9847", "5000"]}], "+", 
       FractionBox[
        RowBox[{"60303", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["48657", "20000"]}], "-", 
       FractionBox[
        RowBox[{"24263", " ", "\[ImaginaryI]"}], "20000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["161833", "100000"]}], "-", 
       FractionBox[
        RowBox[{"3383", " ", "\[ImaginaryI]"}], "50000"]}], 
      RowBox[{
       FractionBox["23339", "6250"], "+", 
       FractionBox[
        RowBox[{"44381", " ", "\[ImaginaryI]"}], "50000"]}], "0", "0", "0", 
      "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      FractionBox["\[ImaginaryI]", "100000"], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["1", "100000"]}], "+", 
       FractionBox["\[ImaginaryI]", "12500"]}], "0"},
     {"0", "0", "0", "0", "0", 
      RowBox[{
       FractionBox["42937", "50000"], "+", 
       FractionBox[
        RowBox[{"45013", " ", "\[ImaginaryI]"}], "25000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["53281", "100000"]}], "-", 
       FractionBox[
        RowBox[{"16953", " ", "\[ImaginaryI]"}], "12500"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["1427", "3125"]}], "-", 
       FractionBox[
        RowBox[{"5253", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["4107", "20000"]}], "+", 
       FractionBox[
        RowBox[{"14753", " ", "\[ImaginaryI]"}], "100000"]}], "0", "0", "0", 
      "0", "0", "0", "0", "0", 
      FractionBox["\[ImaginaryI]", "100000"], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["1", "50000"]}], "-", 
       FractionBox["\[ImaginaryI]", "20000"]}], "0"},
     {"0", "0", "0", "0", "0", 
      RowBox[{
       RowBox[{"-", 
        FractionBox["989", "10000"]}], "+", 
       FractionBox[
        RowBox[{"2957", " ", "\[ImaginaryI]"}], "20000"]}], 
      RowBox[{
       FractionBox["351087", "100000"], "-", 
       FractionBox[
        RowBox[{"323", " ", "\[ImaginaryI]"}], "1000"]}], 
      RowBox[{
       FractionBox["3313", "100000"], "-", 
       FractionBox[
        RowBox[{"4581", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["4789", "100000"]}], "+", 
       FractionBox[
        RowBox[{"2413", " ", "\[ImaginaryI]"}], "100000"]}], "0", "0", "0", 
      "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", 
      RowBox[{
       RowBox[{"-", 
        FractionBox["5977", "50000"]}], "+", 
       FractionBox[
        RowBox[{"22599", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       FractionBox["12523", "25000"], "+", 
       FractionBox[
        RowBox[{"13339", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       FractionBox["194807", "50000"], "-", 
       FractionBox[
        RowBox[{"5899", " ", "\[ImaginaryI]"}], "10000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["5233", "100000"]}], "+", 
       FractionBox[
        RowBox[{"979", " ", "\[ImaginaryI]"}], "10000"]}], "0", "0", "0", "0",
       "0", "0", "0", "0", "0", 
      FractionBox["\[ImaginaryI]", "100000"], "0"},
     {"0", "0", "0", "0", "0", 
      RowBox[{
       RowBox[{"-", 
        FractionBox["9847", "5000"]}], "-", 
       FractionBox[
        RowBox[{"60303", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["48657", "20000"]}], "+", 
       FractionBox[
        RowBox[{"24263", " ", "\[ImaginaryI]"}], "20000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["161833", "100000"]}], "+", 
       FractionBox[
        RowBox[{"3383", " ", "\[ImaginaryI]"}], "50000"]}], 
      RowBox[{
       FractionBox["23339", "6250"], "-", 
       FractionBox[
        RowBox[{"44381", " ", "\[ImaginaryI]"}], "50000"]}], "0", "0", "0", 
      "0", "0", "0", "0", "0", 
      RowBox[{"-", 
       FractionBox["\[ImaginaryI]", "100000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["1", "100000"]}], "-", 
       FractionBox["\[ImaginaryI]", "12500"]}], "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", 
      RowBox[{
       FractionBox["240499", "100000"], "-", 
       FractionBox[
        RowBox[{"134953", " ", "\[ImaginaryI]"}], "50000"]}], 
      RowBox[{
       FractionBox["53193", "50000"], "+", 
       FractionBox[
        RowBox[{"8099", " ", "\[ImaginaryI]"}], "25000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["4981", "100000"]}], "-", 
       FractionBox[
        RowBox[{"5517", " ", "\[ImaginaryI]"}], "25000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["7607", "50000"]}], "-", 
       FractionBox[
        RowBox[{"13839", " ", "\[ImaginaryI]"}], "50000"]}], "0", "0", "0", 
      "0", 
      RowBox[{
       FractionBox["1", "100000"], "+", 
       FractionBox["\[ImaginaryI]", "100000"]}], 
      RowBox[{
       FractionBox["3", "100000"], "-", 
       FractionBox["\[ImaginaryI]", "12500"]}], "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", 
      RowBox[{
       FractionBox["5111", "50000"], "-", 
       FractionBox[
        RowBox[{"2059", " ", "\[ImaginaryI]"}], "10000"]}], 
      RowBox[{
       FractionBox["166421", "50000"], "+", 
       FractionBox[
        RowBox[{"653", " ", "\[ImaginaryI]"}], "50000"]}], 
      RowBox[{
       FractionBox["2333", "25000"], "-", 
       FractionBox[
        RowBox[{"7829", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       FractionBox["1219", "25000"], "-", 
       FractionBox[
        RowBox[{"242", " ", "\[ImaginaryI]"}], "3125"]}], "0", "0", "0", "0", 
      "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", 
      RowBox[{
       FractionBox["177337", "100000"], "+", 
       FractionBox[
        RowBox[{"6317", " ", "\[ImaginaryI]"}], "6250"]}], 
      RowBox[{
       FractionBox["39809", "12500"], "+", 
       FractionBox[
        RowBox[{"82039", " ", "\[ImaginaryI]"}], "20000"]}], 
      RowBox[{
       FractionBox["484491", "100000"], "+", 
       FractionBox[
        RowBox[{"290219", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       FractionBox["10041", "12500"], "+", 
       FractionBox[
        RowBox[{"62367", " ", "\[ImaginaryI]"}], "50000"]}], "0", "0", "0", 
      "0", 
      RowBox[{
       RowBox[{"-", 
        FractionBox["3", "100000"]}], "+", 
       FractionBox[
        RowBox[{"3", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["3", "25000"]}], "-", 
       FractionBox[
        RowBox[{"3", " ", "\[ImaginaryI]"}], "50000"]}], "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", 
      RowBox[{
       RowBox[{"-", 
        FractionBox["12538", "3125"]}], "-", 
       FractionBox[
        RowBox[{"30587", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["681439", "100000"]}], "-", 
       FractionBox[
        RowBox[{"86331", " ", "\[ImaginaryI]"}], "20000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["304103", "100000"]}], "-", 
       FractionBox[
        RowBox[{"120247", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       FractionBox["142167", "100000"], "-", 
       FractionBox[
        RowBox[{"21619", " ", "\[ImaginaryI]"}], "100000"]}], "0", "0", "0", 
      "0", 
      RowBox[{
       FractionBox["1", "50000"], "-", 
       FractionBox["\[ImaginaryI]", "25000"]}], 
      RowBox[{
       FractionBox["1", "10000"], "-", 
       FractionBox["\[ImaginaryI]", "20000"]}], "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      RowBox[{
       FractionBox["240499", "100000"], "+", 
       FractionBox[
        RowBox[{"134953", " ", "\[ImaginaryI]"}], "50000"]}], 
      RowBox[{
       FractionBox["53193", "50000"], "-", 
       FractionBox[
        RowBox[{"8099", " ", "\[ImaginaryI]"}], "25000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["4981", "100000"]}], "+", 
       FractionBox[
        RowBox[{"5517", " ", "\[ImaginaryI]"}], "25000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["7607", "50000"]}], "+", 
       FractionBox[
        RowBox[{"13839", " ", "\[ImaginaryI]"}], "50000"]}], 
      RowBox[{
       FractionBox["1", "100000"], "-", 
       FractionBox["\[ImaginaryI]", "100000"]}], 
      RowBox[{
       FractionBox["3", "100000"], "+", 
       FractionBox["\[ImaginaryI]", "12500"]}], "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      RowBox[{
       FractionBox["5111", "50000"], "+", 
       FractionBox[
        RowBox[{"2059", " ", "\[ImaginaryI]"}], "10000"]}], 
      RowBox[{
       FractionBox["166421", "50000"], "-", 
       FractionBox[
        RowBox[{"653", " ", "\[ImaginaryI]"}], "50000"]}], 
      RowBox[{
       FractionBox["2333", "25000"], "+", 
       FractionBox[
        RowBox[{"7829", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       FractionBox["1219", "25000"], "+", 
       FractionBox[
        RowBox[{"242", " ", "\[ImaginaryI]"}], "3125"]}], "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      RowBox[{
       FractionBox["177337", "100000"], "-", 
       FractionBox[
        RowBox[{"6317", " ", "\[ImaginaryI]"}], "6250"]}], 
      RowBox[{
       FractionBox["39809", "12500"], "-", 
       FractionBox[
        RowBox[{"82039", " ", "\[ImaginaryI]"}], "20000"]}], 
      RowBox[{
       FractionBox["484491", "100000"], "-", 
       FractionBox[
        RowBox[{"290219", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       FractionBox["10041", "12500"], "-", 
       FractionBox[
        RowBox[{"62367", " ", "\[ImaginaryI]"}], "50000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["3", "100000"]}], "-", 
       FractionBox[
        RowBox[{"3", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["3", "25000"]}], "+", 
       FractionBox[
        RowBox[{"3", " ", "\[ImaginaryI]"}], "50000"]}], "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      RowBox[{
       RowBox[{"-", 
        FractionBox["12538", "3125"]}], "+", 
       FractionBox[
        RowBox[{"30587", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["681439", "100000"]}], "+", 
       FractionBox[
        RowBox[{"86331", " ", "\[ImaginaryI]"}], "20000"]}], 
      RowBox[{
       RowBox[{"-", 
        FractionBox["304103", "100000"]}], "+", 
       FractionBox[
        RowBox[{"120247", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       FractionBox["142167", "100000"], "+", 
       FractionBox[
        RowBox[{"21619", " ", "\[ImaginaryI]"}], "100000"]}], 
      RowBox[{
       FractionBox["1", "50000"], "+", 
       FractionBox["\[ImaginaryI]", "25000"]}], 
      RowBox[{
       FractionBox["1", "10000"], "+", 
       FractionBox["\[ImaginaryI]", "20000"]}], "0"},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", 
      FractionBox["5263", "25000"], 
      RowBox[{"-", 
       FractionBox["82673", "100000"]}], 
      RowBox[{"-", 
       FractionBox["6031", "50000"]}]},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", 
      RowBox[{"-", 
       FractionBox["37459", "100000"]}], 
      FractionBox["97957", "25000"], 
      RowBox[{"-", 
       FractionBox["149", "12500"]}]},
     {"0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", 
      "0", "0", "0", 
      RowBox[{"-", 
       FractionBox["202323", "50000"]}], 
      RowBox[{"-", 
       FractionBox["2207", "2500"]}], 
      FractionBox["4839", "1250"]}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.806194098488579*^9, 3.806194391704302*^9, 
  3.806194570508287*^9},
 CellLabel->
  "Out[119]//MatrixForm=",ExpressionUUID->"e32b04e3-de75-41c8-b8c0-\
dd154a3c0280"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Breaking an Existing Matrix into Upper Triangular Blocks", "Section",
 CellChangeTimes->{{3.796589477929007*^9, 
  3.796589508390835*^9}},ExpressionUUID->"5460e043-03c7-44eb-aefc-\
b885896ea875"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"takes", " ", "a", " ", "matrix", " ", "and"}], ",", " ", 
    RowBox[{"without", " ", "chaging", " ", "the", " ", "basis"}], ",", " ", 
    RowBox[{
    "gives", " ", "an", " ", "upper", " ", "block", " ", "triangular", " ", 
     "arragement", " ", "of", " ", "its", " ", "columns"}], ",", " ", 
    RowBox[{
    "namely", " ", "an", " ", "appropriately", " ", "ordered", " ", "list", 
     " ", "of", " ", "lists", " ", "of", " ", "column", " ", "indices", " ", 
     "which", " ", "form", " ", "the", " ", "blocks"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"BlockSort", "[", "matrix_", "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "b", ",", "l", ",", "adjacentcy", ",", "graphTot", ",", "graph", ",", 
        "adList", ",", "unusedInd", ",", "indexing", ",", " ", "added", " ", 
        ",", "c", ",", "paths", ",", "adj", ",", "j", ",", "newPaths", ",", 
        "i", ",", " ", "interval", ",", " ", "graphHere", ",", "addingHere", 
        ",", "lHere", ",", "indicesBlocks", ",", "toKeep"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"b", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"l", "=", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "matrix", "]"}], "]"}], "}"}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"graphTot", "=", 
        RowBox[{"Adj", "[", "matrix", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"unusedInd", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"1", ",", 
          RowBox[{"Length", "[", "matrix", "]"}]}], "]"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"indicies", " ", "of", " ", "original", " ", "columns"}], " ",
         "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Outermost", " ", "loop", " ", "lasts", " ", "while", " ", "there", 
         " ", "is", " ", "some", " ", "columns", " ", "left", " ", 
         "unindexed"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "l", "]"}], ">", "0"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"paths", " ", "=", " ", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"indexing", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{"Position", "[", 
             RowBox[{"unusedInd", ",", "1"}], "]"}], "]"}]}], ";", " ", 
          RowBox[{"(*", " ", 
           RowBox[{
           "Flatten", " ", "is", " ", "used", " ", "here", " ", "to", " ", 
            "make", " ", "the", " ", "strange", " ", "output", " ", "of", " ",
             "Position", " ", "usable"}], " ", "*)"}], "\[IndentingNewLine]", 
          
          RowBox[{"graph", "=", 
           RowBox[{"graphTot", "[", 
            RowBox[{"[", 
             RowBox[{"indexing", ",", "indexing"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"newPaths", "=", 
           RowBox[{"{", 
            RowBox[{"{", "1", "}"}], "}"}]}], ";", " ", 
          RowBox[{"(*", " ", 
           RowBox[{
           "indicies", " ", "of", " ", "blocks", " ", "of", " ", "graph"}], 
           " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"unusedInd", "[", 
            RowBox[{"[", 
             RowBox[{"indexing", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "=", "0"}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{
           "showing", " ", "the", " ", "original", " ", "column", " ", "was", 
            " ", "used", " ", "in", " ", "this", " ", "step"}], " ", "*)"}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "while", " ", "new", " ", "paths", " ", "have", " ", "been", " ", 
            "added", " ", "by", " ", "the", " ", "previous", " ", 
            "itteration", " ", "of", " ", "this", " ", "loop"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"While", "[", 
           RowBox[{
            RowBox[{"newPaths", "!=", "paths"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"paths", "=", "newPaths"}], ";", "\[IndentingNewLine]", 
             RowBox[{"newPaths", "=", 
              RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"adList", "=", 
              RowBox[{"Transpose", "[", "graph", "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"i", "=", "1"}], ",", 
               RowBox[{"i", "\[LessEqual]", 
                RowBox[{"Length", "[", "paths", "]"}]}], ",", 
               RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"adj", "=", " ", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"Position", "[", 
                   RowBox[{
                    RowBox[{"adList", "[", 
                    RowBox[{"[", 
                    RowBox[{"Last", "[", 
                    RowBox[{"paths", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
                    "1"}], "]"}], "]"}]}], ";", "  ", 
                RowBox[{"(*", " ", 
                 RowBox[{
                 "list", " ", "of", " ", "indicies", " ", "of", " ", "blocks",
                   " ", "connected", " ", "to", " ", "current", " ", 
                  "endpoint"}], " ", "*)"}], "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                 "can", " ", "we", " ", "extend", " ", "the", " ", "ith", " ",
                   "path"}], " ", "*)"}], "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", "adj", "]"}], "\[Equal]", "0"}], 
                  ",", "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{"if", " ", "we", " ", 
                    RowBox[{"can", "'"}], 
                    RowBox[{"t", ":"}]}], " ", "*)"}], "\[IndentingNewLine]", 
                  
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"newPaths", ",", 
                    RowBox[{"paths", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
                  "\[IndentingNewLine]", "\[IndentingNewLine]", 
                  RowBox[{"(*", " ", 
                   RowBox[{
                    RowBox[{"if", " ", "we", " ", "can"}], ",", " ", 
                    RowBox[{
                    "iterate", " ", "over", " ", "every", " ", "possible", 
                    " ", 
                    RowBox[{"extension", ":"}]}]}], " ", "*)"}], 
                  "\[IndentingNewLine]", 
                  RowBox[{"For", "[", 
                   RowBox[{
                    RowBox[{"j", "=", "1"}], ",", 
                    RowBox[{"j", "\[LessEqual]", 
                    RowBox[{"Length", "[", "adj", "]"}]}], ",", 
                    RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", 
                    RowBox[{
                    RowBox[{"FirstPosition", "[", 
                    RowBox[{
                    RowBox[{"paths", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"adj", "[", 
                    RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", 
                    RowBox[{"(*", " ", 
                    RowBox[{
                    "if", " ", "this", " ", "extension", " ", "makes", " ", 
                    "the", " ", "path", " ", "loop"}], " ", "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"interval", "=", 
                    RowBox[{
                    RowBox[{"paths", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", " ", 
                    RowBox[{"Range", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"FirstPosition", "[", 
                    RowBox[{
                    RowBox[{"paths", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"adj", "[", 
                    RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ")"}], ",", 
                    RowBox[{"Length", "[", " ", 
                    RowBox[{"paths", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], " ", "]"}]}], " ", "]"}], 
                    " ", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"graph", "=", 
                    RowBox[{"MergeBlocks", "[", 
                    RowBox[{"graph", ",", " ", "interval"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"l", "=", 
                    RowBox[{"MergeBlockLists", "[", 
                    RowBox[{"l", ",", 
                    RowBox[{"Sort", "[", "interval", "]"}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", 
                    RowBox[{"break", " ", "loops"}], " ", "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"j", "=", 
                    RowBox[{
                    RowBox[{"Length", "[", "adj", "]"}], "+", "1"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"i", "=", 
                    RowBox[{
                    RowBox[{"Length", "[", "paths", "]"}], "+", "1"}]}], ";", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", 
                    RowBox[{
                    "reset", " ", "varaibles", " ", "to", " ", "begin", " ", 
                    "loop"}], " ", "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"paths", "=", 
                    RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"newPaths", "=", 
                    RowBox[{"{", 
                    RowBox[{"{", "1", "}"}], "}"}]}]}], ",", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", 
                    RowBox[{
                    RowBox[{"update", " ", "unusedInd"}], ",", " ", 
                    RowBox[{
                    "add", " ", "new", " ", "path", " ", "to", " ", 
                    "list"}]}], " ", "*)"}], "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"unusedInd", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"l", "[", 
                    RowBox[{"[", 
                    RowBox[{"adj", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "=", "0"}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"newPaths", ",", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"paths", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"adj", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "}"}]}], " ", "]"}]}], 
                    "]"}]}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
                   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
                 "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "find", " ", "the", " ", "vectors", " ", "which", " ", "have", " ",
             "formed", " ", "part", " ", "of", " ", "the", " ", "above", " ", 
            "path", " ", "structure", " ", "to", " ", "add"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"addingHere", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", "=", "1"}], ",", 
            RowBox[{"i", "\[LessEqual]", 
             RowBox[{"Length", "[", "l", "]"}]}], ",", 
            RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"unusedInd", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"l", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "\[Equal]", 
               "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"addingHere", ",", "i"}], "]"}], ",", 
              "\[IndentingNewLine]", "Null"}], "\[IndentingNewLine]", "]"}]}],
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"graphHere", "=", 
           RowBox[{"graph", "[", 
            RowBox[{"[", 
             RowBox[{"addingHere", ",", " ", "addingHere"}], "]"}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"lHere", "=", 
           RowBox[{"l", "[", 
            RowBox[{"[", "addingHere", "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"l", "=", 
           RowBox[{"Delete", "[", 
            RowBox[{"l", ",", 
             RowBox[{"Transpose", "[", 
              RowBox[{"{", "addingHere", "}"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"While", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "graphHere", "]"}], ">", "0"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"indicesBlocks", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{"Position", "[", 
                RowBox[{
                 RowBox[{"Transpose", "[", "graphHere", "]"}], ",", 
                 RowBox[{"ConstantArray", "[", 
                  RowBox[{"0", ",", 
                   RowBox[{"Length", "[", "graphHere", "]"}]}], "]"}]}], 
                "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"b", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"b", ",", 
                RowBox[{"lHere", "[", 
                 RowBox[{"[", "indicesBlocks", "]"}], "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"toKeep", "=", 
              RowBox[{"Complement", "[", 
               RowBox[{
                RowBox[{"Range", "[", 
                 RowBox[{"Length", "[", "graphHere", "]"}], "]"}], ",", 
                "indicesBlocks"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"addingHere", "=", 
              RowBox[{"addingHere", "[", 
               RowBox[{"[", "toKeep", "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"lHere", "=", 
              RowBox[{"lHere", "[", 
               RowBox[{"[", "toKeep", "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"graphHere", " ", "=", " ", 
              RowBox[{"graphHere", "[", 
               RowBox[{"[", 
                RowBox[{"toKeep", ",", "toKeep"}], "]"}], "]"}]}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "b"}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7905732922149963`*^9, 3.790573381994437*^9}, 
   3.790573504065909*^9, {3.79057364747357*^9, 3.790573822180558*^9}, {
   3.790574207748416*^9, 3.7905742119526787`*^9}, {3.790574248128172*^9, 
   3.790574248288723*^9}, {3.7905742809410686`*^9, 3.790574294800424*^9}, 
   3.790591807012381*^9, {3.790592564083675*^9, 3.79059262223178*^9}, {
   3.790592695269124*^9, 3.7905927205068607`*^9}, {3.790592757492382*^9, 
   3.7905928476868134`*^9}, {3.790592890211412*^9, 3.7905929676836863`*^9}, {
   3.7905930741563053`*^9, 3.790593102726679*^9}, {3.790593140249053*^9, 
   3.790593439295423*^9}, {3.790593470527699*^9, 3.7905934734706697`*^9}, {
   3.790593674477117*^9, 3.790593763009808*^9}, {3.790593821192728*^9, 
   3.790593821811969*^9}, {3.790595266945612*^9, 3.790595271405127*^9}, {
   3.790595397822641*^9, 3.7905954176921673`*^9}, {3.7905954939839478`*^9, 
   3.790595532198802*^9}, {3.7905955918473177`*^9, 3.790595610232068*^9}, {
   3.7905956586106653`*^9, 3.7905956897629147`*^9}, 3.7905957491208687`*^9, {
   3.790595938341543*^9, 3.790595999484421*^9}, {3.7905960752352133`*^9, 
   3.790596075613957*^9}, {3.790596123947502*^9, 3.79059612580965*^9}, {
   3.790596252344198*^9, 3.79059625763993*^9}, {3.790596302044367*^9, 
   3.790596309515347*^9}, {3.790596377968471*^9, 3.790596394807211*^9}, {
   3.790596431268882*^9, 3.790596472254272*^9}, {3.79059653497077*^9, 
   3.7905965734536467`*^9}, {3.790596711988965*^9, 3.790596724355546*^9}, {
   3.790596766198183*^9, 3.79059678458764*^9}, {3.790596824117138*^9, 
   3.790596825383606*^9}, {3.790596873668611*^9, 3.790596930356777*^9}, {
   3.79059703319986*^9, 3.790597037616686*^9}, {3.790597098834086*^9, 
   3.790597388198234*^9}, {3.7905974405905247`*^9, 3.7905975458381977`*^9}, {
   3.790597577848143*^9, 3.7905975796900253`*^9}, {3.7905976323329163`*^9, 
   3.7905976488052588`*^9}, {3.790597719030757*^9, 3.790597722956169*^9}, {
   3.79061122474612*^9, 3.790611279263112*^9}, {3.790611314845208*^9, 
   3.790611346851254*^9}, {3.790611440264659*^9, 3.790611449471837*^9}, {
   3.790611564251247*^9, 3.790611568789298*^9}, {3.7906116343090677`*^9, 
   3.790611636038109*^9}, {3.7906117905438337`*^9, 3.790611857466288*^9}, {
   3.7906119424649277`*^9, 3.79061197022338*^9}, {3.7906120471169577`*^9, 
   3.7906120862270927`*^9}, {3.790620694057651*^9, 3.790620816793618*^9}, {
   3.790620922299856*^9, 3.790620938034841*^9}, {3.790621091756627*^9, 
   3.7906211043954697`*^9}, {3.790621391689762*^9, 3.790621397426998*^9}, {
   3.790621516242029*^9, 3.790621517034029*^9}, {3.790621554493795*^9, 
   3.790621591943421*^9}, {3.790628997300105*^9, 3.79062900665246*^9}, {
   3.7906290597483263`*^9, 3.790629108633095*^9}, {3.790629200558243*^9, 
   3.790629264295517*^9}, {3.790629348617557*^9, 3.790629356572638*^9}, {
   3.7906297668268003`*^9, 3.79062978214493*^9}, 3.791802461580607*^9, {
   3.791869282168315*^9, 3.791869369510028*^9}, {3.7918758199209633`*^9, 
   3.7918761516125307`*^9}, {3.7918761858070087`*^9, 3.791876423135437*^9}, {
   3.7918764641723337`*^9, 3.791876671968417*^9}, {3.7918767325372334`*^9, 
   3.791876738609509*^9}, {3.7918767999407177`*^9, 3.7918768053710203`*^9}, {
   3.791876931724386*^9, 3.791876936979*^9}, {3.791876991237795*^9, 
   3.791876993954165*^9}, 3.791877116262082*^9, {3.791887973224347*^9, 
   3.791887977437767*^9}, {3.7918880385228786`*^9, 3.7918880445642767`*^9}, {
   3.791888083077424*^9, 3.791888094311572*^9}, {3.791888248507365*^9, 
   3.791888336179147*^9}, {3.79188844655608*^9, 3.791888461297225*^9}, {
   3.792263099869268*^9, 3.792263102665407*^9}, {3.792263134883607*^9, 
   3.7922631589641438`*^9}, {3.7922632203779783`*^9, 3.792263486508189*^9}, {
   3.792263713949737*^9, 3.792263724343813*^9}, 3.792263792676865*^9, {
   3.792263844088221*^9, 3.79226397588372*^9}, {3.79226401409523*^9, 
   3.792264016149626*^9}, {3.792264064392844*^9, 3.792264127732534*^9}, {
   3.7922643454001207`*^9, 3.792264349454867*^9}, {3.792264389180401*^9, 
   3.792264436452125*^9}, {3.7922644741320143`*^9, 3.792264476795973*^9}, {
   3.792328830803318*^9, 3.7923288728374367`*^9}, {3.792328922065522*^9, 
   3.792328928426936*^9}, {3.79232917562074*^9, 3.7923291776208553`*^9}, {
   3.792329208828835*^9, 3.792329306555523*^9}, {3.792329342449402*^9, 
   3.792329353062801*^9}, 3.7923293945474453`*^9, {3.792329437276854*^9, 
   3.792329454965334*^9}, 3.792329490841015*^9, {3.792329533252863*^9, 
   3.792329610273786*^9}, {3.792337175246224*^9, 3.7923372219097977`*^9}, {
   3.792337253485589*^9, 3.792337296817576*^9}, {3.7923373290094337`*^9, 
   3.7923373327492733`*^9}, 3.792338346048254*^9, {3.792338477193778*^9, 
   3.792338520822652*^9}, {3.7923386008096933`*^9, 3.7923386101631737`*^9}, {
   3.79233888839915*^9, 3.792338894513612*^9}, {3.7923389344702063`*^9, 
   3.792339018531027*^9}, {3.796595180495693*^9, 3.7965952461293373`*^9}, {
   3.796595396421411*^9, 3.7965955275972*^9}, {3.796595558214199*^9, 
   3.796595633453402*^9}, {3.79659570625953*^9, 3.796595836325788*^9}, {
   3.7965959303854437`*^9, 3.796595949619519*^9}, {3.7966744888535013`*^9, 
   3.796674500473878*^9}, {3.796674621741572*^9, 3.796674622315995*^9}, {
   3.796674791840486*^9, 3.79667482271533*^9}, {3.7967268000492897`*^9, 
   3.796726843876465*^9}, 3.796727004280897*^9, {3.796730150920705*^9, 
   3.796730176162334*^9}, {3.79700177031234*^9, 3.797001772015257*^9}, {
   3.797049541179147*^9, 3.7970495598700666`*^9}, {3.797051514724826*^9, 
   3.797051519754468*^9}, {3.797051580758915*^9, 3.797051587255807*^9}, {
   3.797073841450283*^9, 3.7970738555372047`*^9}, {3.7970738990463943`*^9, 
   3.79707393878868*^9}, {3.797074022923931*^9, 3.797074035561146*^9}, 
   3.7970741903116817`*^9},
 CellLabel->"In[6]:=",ExpressionUUID->"23b63a48-8466-4af0-9bbc-638489299f3f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MergeBlockLists", "[", 
    RowBox[{"list_", ",", "interval_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"toReturn", ",", "toReplace", ",", "i", ",", " ", "toRemove"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"toReplace", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", 
         RowBox[{"Length", "[", "interval", "]"}]}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"toReplace", "=", 
         RowBox[{"Union", "[", 
          RowBox[{"toReplace", ",", " ", 
           RowBox[{"list", "[", 
            RowBox[{"[", 
             RowBox[{"interval", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}]}], "]"}]}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"toRemove", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{"Rest", "[", "interval", "]"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"toReturn", "=", 
       RowBox[{"Delete", "[", 
        RowBox[{"list", ",", "toRemove"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"toReturn", "[", 
        RowBox[{"[", 
         RowBox[{"interval", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "=", "toReplace"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "toReturn"}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7905735675296793`*^9, 3.7905736076163473`*^9}, {
   3.7905738318183613`*^9, 3.790574075493121*^9}, {3.7905741056677027`*^9, 
   3.7905741071612597`*^9}, {3.790574143901973*^9, 3.790574201463685*^9}, {
   3.7905983288337507`*^9, 3.790598335667377*^9}, {3.790598867325625*^9, 
   3.79059888949853*^9}, {3.790598986210148*^9, 3.7905991907520514`*^9}, {
   3.790599314252359*^9, 3.790599319582446*^9}, 3.790599356827507*^9, {
   3.7905994031881027`*^9, 3.790599624038419*^9}, {3.790599685598885*^9, 
   3.790599809146806*^9}, {3.790599846175844*^9, 3.7905998955188932`*^9}, {
   3.7923376293099213`*^9, 3.792337870360455*^9}, {3.792337925919272*^9, 
   3.792337928792657*^9}, {3.792338085288719*^9, 3.792338100259384*^9}, {
   3.796703727973959*^9, 3.7967037389435663`*^9}, {3.7967042684490213`*^9, 
   3.796704277798935*^9}, {3.796704349751527*^9, 3.796704364423868*^9}, {
   3.796704401285411*^9, 3.796704477891364*^9}, {3.796704578089205*^9, 
   3.796704660515814*^9}, {3.796704692677022*^9, 3.796704847147403*^9}, {
   3.796726573433375*^9, 3.796726578258377*^9}, {3.796726609040106*^9, 
   3.7967266516896048`*^9}, {3.7967266850742683`*^9, 
   3.7967267123897667`*^9}, {3.7967269286533327`*^9, 3.7967269298248653`*^9}, 
   3.7967293450435743`*^9},
 CellLabel->"In[7]:=",ExpressionUUID->"fa0cb441-22b6-4122-a6da-082288353e6b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MergeBlocks", "[", 
   RowBox[{"adj_", ",", "list_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "i", ",", "range", ",", "j", ",", "outRange", ",", "toReturn", ",", 
      "sorted", ",", "trans"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"range", "=", 
      RowBox[{"Range", "[", 
       RowBox[{"Length", "[", "adj", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sorted", "=", 
      RowBox[{"Sort", "[", 
       RowBox[{"list", ",", "Greater"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", 
       RowBox[{"i", "\[LessEqual]", 
        RowBox[{"Length", "[", "sorted", "]"}]}], ",", 
       RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{"range", "=", 
        RowBox[{"Delete", "[", 
         RowBox[{"range", ",", 
          RowBox[{"sorted", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]",
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"outRange", "=", "range"}], ";", "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", 
       RowBox[{"i", "\[LessEqual]", 
        RowBox[{"Length", "[", "range", "]"}]}], ",", 
       RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"outRange", "[", 
           RowBox[{"[", "i", "]"}], "]"}], ">", 
          RowBox[{"Last", "[", "sorted", "]"}]}], ",", "\[IndentingNewLine]", 
         
         RowBox[{
          RowBox[{"outRange", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "=", 
          RowBox[{"i", "+", "1"}]}], ",", "\[IndentingNewLine]", "Null"}], 
        "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"toReturn", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "adj", "]"}], "-", 
           RowBox[{"Length", "[", "list", "]"}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"Length", "[", "adj", "]"}], "-", 
           RowBox[{"Length", "[", "list", "]"}], "+", "1"}]}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", 
       RowBox[{"i", "\[LessEqual]", 
        RowBox[{"Length", "[", "range", "]"}]}], ",", 
       RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"j", "=", "1"}], ",", 
         RowBox[{"j", "\[LessEqual]", 
          RowBox[{"Length", "[", "range", "]"}]}], ",", 
         RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"adj", "[", 
              RowBox[{"[", 
               RowBox[{"range", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"range", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "\[Equal]", 
            "1"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"toReturn", "[", 
              RowBox[{"[", 
               RowBox[{"outRange", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"outRange", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "=", "1"}], ",", 
           "\[IndentingNewLine]", "Null"}], "\[IndentingNewLine]", "]"}]}], 
        "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", 
       RowBox[{"i", "\[LessEqual]", 
        RowBox[{"Length", "[", "range", "]"}]}], ",", 
       RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"trans", "=", 
         RowBox[{"Transpose", "[", "adj", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "[", 
           RowBox[{"AllZeroes", "[", " ", 
            RowBox[{
             RowBox[{"trans", "[", 
              RowBox[{"[", " ", 
               RowBox[{"range", "[", 
                RowBox[{"[", "i", "]"}], "]"}], " ", "]"}], "]"}], "[", 
             RowBox[{"[", "list", "]"}], "]"}], " ", "]"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"toReturn", "[", 
             RowBox[{"[", 
              RowBox[{"Last", "[", "sorted", "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"outRange", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "=", "1"}], ",", 
          "\[IndentingNewLine]", "Null"}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "[", 
           RowBox[{"AllZeroes", "[", " ", 
            RowBox[{
             RowBox[{"adj", "[", 
              RowBox[{"[", " ", 
               RowBox[{"range", "[", 
                RowBox[{"[", "i", "]"}], "]"}], " ", "]"}], "]"}], "[", 
             RowBox[{"[", "list", "]"}], "]"}], " ", "]"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"toReturn", "[", 
             RowBox[{"[", 
              RowBox[{"outRange", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"Last", "[", "sorted", "]"}], "]"}], "]"}], "=", "1"}], 
          ",", "\[IndentingNewLine]", "Null"}], "\[IndentingNewLine]", 
         "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "toReturn"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.790574415915638*^9, 3.790574416927737*^9}, {
   3.790597944951892*^9, 3.790597989605441*^9}, {3.7905980222294083`*^9, 
   3.790598036251678*^9}, {3.79059811052236*^9, 3.7905981150125713`*^9}, {
   3.79059824572611*^9, 3.7905983802019043`*^9}, {3.7905984249376373`*^9, 
   3.7905984448226833`*^9}, {3.7905984766754417`*^9, 3.79059850769726*^9}, {
   3.790598541964981*^9, 3.790598543737721*^9}, {3.790598613784294*^9, 
   3.79059861448759*^9}, 3.790598677355818*^9, {3.7905993035089273`*^9, 
   3.790599309655321*^9}, {3.7905993435795403`*^9, 3.790599351146269*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"91913ee2-1a6e-4bd5-a927-c172eb40bd62"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"returns", " ", "a", " ", "matrix", " ", "with", " ", 
     RowBox[{"a", " ", "'"}], 
     RowBox[{"1", "'"}], " ", "in", " ", "a", " ", "place", " ", "with", " ", 
     "a", " ", "nonzero", " ", "entry", " ", 
     RowBox[{"and", " ", "'"}], 
     RowBox[{"0", "'"}], " ", "otherwise"}], ",", " ", 
    RowBox[{"recording", " ", "the", " ", "adjacency"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Adj", "[", "matrix_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"i", ",", "j", ",", "toReturn"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"toReturn", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"-", "1"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "matrix", "]"}], ",", 
            RowBox[{"Length", "[", 
             RowBox[{"matrix", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "\[LessEqual]", 
          RowBox[{"Length", "[", "matrix", "]"}]}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", 
            RowBox[{"Length", "[", 
             RowBox[{"matrix", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"And", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"matrix", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "\[NotEqual]", "0"}], ",", 
                " ", 
                RowBox[{"i", "\[NotEqual]", "j"}]}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"toReturn", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "[", 
                RowBox[{"[", "j", "]"}], "]"}], "=", "1"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"toReturn", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "[", 
                RowBox[{"[", "j", "]"}], "]"}], "=", "0"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"And", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"toReturn", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "\[Equal]", 
                 RowBox[{"-", "1"}]}], ",", " ", 
                RowBox[{"i", "\[NotEqual]", "j"}]}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"toReturn", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "[", 
                RowBox[{"[", "j", "]"}], "]"}], "=", "1"}], ",", 
              "\[IndentingNewLine]", "Null"}], "\[IndentingNewLine]", "]"}], 
            ";"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "toReturn"}]}], "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"AllZeroes", "[", "array_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"flat", ",", "i"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"flat", "=", 
        RowBox[{"Flatten", "[", "array", "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "\[LessEqual]", 
          RowBox[{"Length", "[", "flat", "]"}]}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"flat", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "\[Equal]", "0"}], ",", 
           "\[IndentingNewLine]", "Null", ",", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}], "\[IndentingNewLine]", 
          "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "True"}]}], "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.797294196489791*^9, 3.797294272453435*^9}, {
  3.797294551718198*^9, 3.79729458980499*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"401d215a-b9ad-4b6b-bfc3-de15640adf83"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Two intertwined clusters with bi-directional flow", "Section",
 CellChangeTimes->{{3.799414501327322*^9, 3.799414569685688*^9}, {
   3.799431102115837*^9, 3.799431123371296*^9}, {3.7994315390384417`*^9, 
   3.799431548299197*^9}, 3.799434340366502*^9, {3.799450240204464*^9, 
   3.799450248965768*^9}},
 Background->RGBColor[
  0.94, 0.88, 0.94],ExpressionUUID->"0af7d947-a85c-4190-b12f-9a20a68c8a7e"],

Cell[TextData[{
 "Adjacency matrix ",
 StyleBox["A", "Code"],
 " and diagonal matrices ",
 StyleBox["C1", "Code"],
 " and ",
 StyleBox["C2", "Code"],
 " encoding clusters"
}], "Text",
 CellChangeTimes->{{3.799414612727726*^9, 3.799414619446245*^9}, {
   3.799415066406357*^9, 3.79941516513525*^9}, 3.799432474097878*^9},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"5c2499e8-d5c5-4cd8-a82f-ff7afe8d1b47"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"A", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "0", ",", "1", ",", "0", ",", "1"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "1", ",", "0", ",", "0", ",", "1"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "0", ",", "1", ",", "1", ",", "0"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "1", ",", "0", ",", "1", ",", "0"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "0", ",", "1", ",", "0", ",", "0"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "1", ",", "0", ",", "0", ",", "0"}], 
      "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"C1", "=", " ", 
   RowBox[{"DiagonalMatrix", "[", 
    RowBox[{"{", 
     RowBox[{"1", ",", "1", ",", "1", ",", "1", ",", "0", ",", "0"}], "}"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"C2", "=", " ", 
   RowBox[{"DiagonalMatrix", "[", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "1"}], "}"}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.799414669182939*^9, 3.799414841925218*^9}, {
  3.799414890057472*^9, 3.799414894962132*^9}, {3.799414925631233*^9, 
  3.799414977467211*^9}, {3.799415187035104*^9, 3.799415227321734*^9}, {
  3.799427966880003*^9, 3.7994280126530237`*^9}, {3.7994309291885643`*^9, 
  3.799430985340529*^9}, {3.799450262421053*^9, 3.799450346162561*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"901d8139-e152-44c9-9cd9-d0e9e9a2b6fd"],

Cell[TextData[{
 "Convert adjacency matrix ",
 StyleBox["A", "Code"],
 " into Laplacian matrix ",
 StyleBox["L", "Code"]
}], "Text",
 CellChangeTimes->{{3.79941527009396*^9, 3.799415271078031*^9}, {
  3.79941530937466*^9, 3.799415378806513*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"5cf28579-a30c-472a-9699-5b9c1e796319"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Diag", "=", 
   RowBox[{"DiagonalMatrix", "[", 
    RowBox[{"Total", "[", 
     RowBox[{"A", ",", 
      RowBox[{"{", "2", "}"}]}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"L", "=", 
   RowBox[{"Diag", "-", "A"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.799415418428997*^9, 3.7994154498842487`*^9}, {
  3.799427907903132*^9, 3.799427923666253*^9}, {3.799428065980795*^9, 
  3.799428066743854*^9}},
 CellLabel->"In[14]:=",ExpressionUUID->"fae748a2-7f69-4a23-b949-c10348e04a24"],

Cell[TextData[{
 "Generate a random combination ",
 StyleBox["M", "Code"],
 " of all generating matrices so we don\[CloseCurlyQuote]t have to worry \
about degeneracy (or use the form suggested in the paper for better alignment \
with clusters)"
}], "Text",
 CellChangeTimes->{{3.79941527009396*^9, 3.799415271078031*^9}, {
  3.79941530937466*^9, 3.799415378806513*^9}, {3.799415525186016*^9, 
  3.799415568046137*^9}, {3.799415947907683*^9, 3.799415948232992*^9}, {
  3.799416031877707*^9, 3.799416043254402*^9}, {3.799431563724298*^9, 
  3.799431618460472*^9}, {3.7994316839605618`*^9, 3.799431705539885*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"8cb4572a-884a-43f2-95bd-54e25c022354"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"M", " ", "=", 
   RowBox[{
    RowBox[{"2", "*", "L"}], " ", "+", " ", 
    RowBox[{"3", "*", "C1"}], " ", "+", " ", 
    RowBox[{"5", "*", "C2"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"M", " ", "=", 
     RowBox[{
      RowBox[{"C1", ".", "L", ".", "C1"}], " ", "+", 
      RowBox[{"C2", ".", "L", ".", "C2"}]}]}], ";"}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.799415790153862*^9, 3.7994158483728867`*^9}, {
  3.7994158799116793`*^9, 3.7994159030968924`*^9}, {3.7994298601023207`*^9, 
  3.799429867068618*^9}, {3.7994299657312937`*^9, 3.799429972584841*^9}, {
  3.799430040407251*^9, 3.799430041148488*^9}, {3.799430502221736*^9, 
  3.799430561484057*^9}, {3.799430613559917*^9, 3.799430616105988*^9}, {
  3.799430748437825*^9, 3.7994307690038147`*^9}, {3.799430799966216*^9, 
  3.79943081574116*^9}, {3.7994317185900917`*^9, 3.799431720482313*^9}, {
  3.799432681155864*^9, 3.799432684091465*^9}, {3.799433221719895*^9, 
  3.799433259979487*^9}, {3.799435492098774*^9, 3.7994355023606167`*^9}, {
  3.79945048669154*^9, 3.799450486961978*^9}, {3.799450536435299*^9, 
  3.7994505480831413`*^9}, {3.799450706897809*^9, 3.7994507286692457`*^9}, {
  3.799450976118347*^9, 3.799450978434938*^9}, {3.799451293225724*^9, 
  3.799451309908751*^9}},
 CellLabel->"In[16]:=",ExpressionUUID->"d0cad91f-5269-4b3c-83ae-58b242f94a74"],

Cell[TextData[{
 "Find the basis for the common block upper triangular form by finding the \
Jordan decomposition of ",
 StyleBox["M", "Code"]
}], "Text",
 CellChangeTimes->{{3.79941527009396*^9, 3.799415271078031*^9}, {
  3.79941530937466*^9, 3.799415378806513*^9}, {3.799415525186016*^9, 
  3.799415568046137*^9}, {3.799415947907683*^9, 3.799415948232992*^9}, {
  3.799416031877707*^9, 3.799416043254402*^9}, {3.799416111423686*^9, 
  3.799416163394915*^9}, {3.799432434311125*^9, 3.799432434546299*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"c1a047d5-9807-4c91-bf92-47c609cb2229"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"s", ",", "j"}], "}"}], " ", "=", " ", 
   RowBox[{"JordanDecomposition", "[", "M", "]"}]}], " ", ";"}]], "Input",
 CellChangeTimes->{{3.799415790153862*^9, 3.7994158483728867`*^9}, {
   3.7994158799116793`*^9, 3.7994159030968924`*^9}, {3.799416205956647*^9, 
   3.799416240175399*^9}, {3.7994163066010237`*^9, 3.7994163101111383`*^9}, 
   3.799431780099538*^9},
 CellLabel->"In[17]:=",ExpressionUUID->"ad199950-42e6-450e-97ad-08852d09b5f5"],

Cell[TextData[{
 "Find the form of ",
 StyleBox["L", "Code"],
 " under the similarity transformation ",
 StyleBox["s", "Code"]
}], "Text",
 CellChangeTimes->{{3.799431828189337*^9, 3.799431871732072*^9}, {
  3.7994321142424173`*^9, 3.799432167196562*^9}, {3.7994326963978643`*^9, 
  3.7994327079245*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"9a713d86-c70a-441d-8928-092425d411ae"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"S", " ", "=", " ", 
   RowBox[{"Inverse", "[", "s", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"TempL", " ", "=", " ", 
   RowBox[{"S", ".", "L", ".", "s"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7994176335202227`*^9, 3.799417641775072*^9}, {
  3.7994176872029943`*^9, 3.799417703831483*^9}, {3.7994282087096252`*^9, 
  3.7994282726043577`*^9}, {3.799428362806028*^9, 3.799428366312415*^9}, {
  3.799428415961931*^9, 3.799428418858419*^9}, {3.799428473672982*^9, 
  3.799428516387446*^9}, {3.799428592814047*^9, 3.799428600471874*^9}, {
  3.799429341468964*^9, 3.799429342052362*^9}, {3.799429470008029*^9, 
  3.799429487535706*^9}, {3.799431820837278*^9, 3.799431825290606*^9}, {
  3.799432125932681*^9, 3.799432127813827*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"062ae511-1207-4c86-a7ec-4c8b63b0024b"],

Cell[TextData[{
 "Use the BlockSort algorithm to reorder the basis ",
 StyleBox["s", "Code"],
 " so that it can be used to reveal the common block upper triangular form \
(here I am doing it manually because BlockSort didn\[CloseCurlyQuote]t seem \
to find the desired order)"
}], "Text",
 CellChangeTimes->{{3.799432182618843*^9, 3.799432205300385*^9}, {
  3.799432251560223*^9, 3.7994322740190773`*^9}, {3.79943230668435*^9, 
  3.799432316467209*^9}, {3.7994323688085213`*^9, 3.799432409009536*^9}, {
  3.79943271163017*^9, 3.799432745797324*^9}, {3.799433734011639*^9, 
  3.799433766250924*^9}, {3.799433806100019*^9, 3.799433830574748*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"677384d1-d4f1-4781-9c53-a93e000cf670"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"order", "=", 
  RowBox[{"BlockSort", "[", "TempL", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"order", " ", "=", " ", 
   RowBox[{"Flatten", "[", "order", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"s", "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "All"}], "]"}], "]"}], "=", 
   RowBox[{"s", "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "order"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"s", "//", "MatrixForm"}]}], "Input",
 CellChangeTimes->{{3.799428707029374*^9, 3.79942871899384*^9}, {
  3.799429178478023*^9, 3.799429287893588*^9}, {3.79942980670231*^9, 
  3.7994298264554367`*^9}, {3.799431063743132*^9, 3.799431081540015*^9}, {
  3.799433718084161*^9, 3.7994337273795977`*^9}, {3.799433837668214*^9, 
  3.7994338615658092`*^9}, {3.7994339367909*^9, 3.799433938087586*^9}, {
  3.799450381525877*^9, 3.7994503845132303`*^9}, {3.799450601883066*^9, 
  3.799450604900134*^9}, {3.7994510250604343`*^9, 3.799451030923307*^9}, {
  3.7994512163046007`*^9, 3.799451217832877*^9}, {3.799451762704636*^9, 
  3.799451797839579*^9}, {3.83310861959832*^9, 3.833108619784089*^9}, {
  3.833109732187416*^9, 3.833109732756873*^9}, {3.83340872028058*^9, 
  3.833408760758295*^9}},
 CellLabel->"In[20]:=",ExpressionUUID->"e97e886c-357f-4074-9f8b-17135c0cef7e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", "1", "}"}], ",", 
   RowBox[{"{", "4", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "3", ",", "5", ",", "6"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.7994511873284693`*^9, 3.799451221784999*^9, 3.799451318613551*^9, {
   3.7994517781494207`*^9, 3.799451805711817*^9}, {3.833108614290208*^9, 
   3.8331086475077543`*^9}, 3.833408780157267*^9},
 CellLabel->"Out[20]=",ExpressionUUID->"86635202-db5a-40fb-9058-6383ef4fb09a"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"1", 
      RowBox[{"-", "1"}], "0", 
      RowBox[{"-", 
       FractionBox["1", "4"]}], 
      FractionBox[
       RowBox[{"9", "+", 
        RowBox[{"5", " ", 
         SqrtBox["3"]}]}], 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{"3", "+", 
          RowBox[{"2", " ", 
           SqrtBox["3"]}]}], ")"}]}]], 
      FractionBox[
       RowBox[{
        RowBox[{"-", "9"}], "+", 
        RowBox[{"5", " ", 
         SqrtBox["3"]}]}], 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "3"}], "+", 
          RowBox[{"2", " ", 
           SqrtBox["3"]}]}], ")"}]}]]},
     {"1", "1", "0", "0", 
      FractionBox[
       RowBox[{"9", "+", 
        RowBox[{"5", " ", 
         SqrtBox["3"]}]}], 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{"3", "+", 
          RowBox[{"2", " ", 
           SqrtBox["3"]}]}], ")"}]}]], 
      FractionBox[
       RowBox[{
        RowBox[{"-", "9"}], "+", 
        RowBox[{"5", " ", 
         SqrtBox["3"]}]}], 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "3"}], "+", 
          RowBox[{"2", " ", 
           SqrtBox["3"]}]}], ")"}]}]]},
     {
      RowBox[{"-", "1"}], 
      RowBox[{"-", "1"}], "0", 
      FractionBox["1", "4"], 
      FractionBox[
       RowBox[{"9", "+", 
        RowBox[{"5", " ", 
         SqrtBox["3"]}]}], 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{"3", "+", 
          RowBox[{"2", " ", 
           SqrtBox["3"]}]}], ")"}]}]], 
      FractionBox[
       RowBox[{
        RowBox[{"-", "9"}], "+", 
        RowBox[{"5", " ", 
         SqrtBox["3"]}]}], 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "3"}], "+", 
          RowBox[{"2", " ", 
           SqrtBox["3"]}]}], ")"}]}]]},
     {
      RowBox[{"-", "1"}], "1", "0", "0", 
      FractionBox[
       RowBox[{"9", "+", 
        RowBox[{"5", " ", 
         SqrtBox["3"]}]}], 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{"3", "+", 
          RowBox[{"2", " ", 
           SqrtBox["3"]}]}], ")"}]}]], 
      FractionBox[
       RowBox[{
        RowBox[{"-", "9"}], "+", 
        RowBox[{"5", " ", 
         SqrtBox["3"]}]}], 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "3"}], "+", 
          RowBox[{"2", " ", 
           SqrtBox["3"]}]}], ")"}]}]]},
     {"0", "0", 
      FractionBox["1", "2"], "0", "1", "1"},
     {"0", "0", 
      RowBox[{"-", 
       FractionBox["1", "2"]}], "0", "1", "1"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{
  3.7994511873284693`*^9, 3.799451221784999*^9, 3.799451318613551*^9, {
   3.7994517781494207`*^9, 3.799451805711817*^9}, {3.833108614290208*^9, 
   3.8331086475077543`*^9}, 3.833408780158785*^9},
 CellLabel->
  "Out[23]//MatrixForm=",ExpressionUUID->"89a4b81b-7809-4c99-aaae-\
5e95077b83f6"]
}, Open  ]],

Cell["The final common block upper triangular form", "Text",
 CellChangeTimes->{{3.799432797289091*^9, 3.799432805587009*^9}, {
  3.7994329130829353`*^9, 3.799432918319117*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"4f1f3999-3a7b-4679-9dda-6cf053500ee1"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"S", " ", "=", " ", 
   RowBox[{"Inverse", "[", "s", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"FinalL", " ", "=", " ", 
  RowBox[{
   RowBox[{"Simplify", "[", 
    RowBox[{"S", ".", "L", ".", "s"}], "]"}], "//", 
   "MatrixForm"}]}]}], "Input",
 CellChangeTimes->{{3.7994296030779743`*^9, 3.7994296124863853`*^9}, 
   3.799432772696725*^9, {3.799451389342931*^9, 3.799451395726418*^9}, {
   3.799451435078732*^9, 3.7994514444701653`*^9}, {3.799451515941296*^9, 
   3.7994515415358553`*^9}, {3.79945158231382*^9, 3.79945158278277*^9}, {
   3.799451723523452*^9, 3.799451728565948*^9}, {3.833108668657436*^9, 
   3.833108747428082*^9}, {3.833109692854342*^9, 3.833109695253069*^9}, {
   3.83340881406404*^9, 3.833408816971622*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"8fd4dfe0-3432-4974-a5b8-8932efcb4d44"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"3", "0", 
      FractionBox["1", "2"], "0", "0", "0"},
     {"0", "5", "0", "0", "0", "0"},
     {"0", "0", "2", 
      FractionBox["1", "2"], "0", "0"},
     {"0", "0", "0", "3", "0", "0"},
     {"0", "0", "0", "0", 
      RowBox[{
       FractionBox["1", "6"], " ", 
       RowBox[{"(", 
        RowBox[{"9", "-", 
         RowBox[{"5", " ", 
          SqrtBox["3"]}]}], ")"}]}], 
      RowBox[{
       FractionBox["1", "6"], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", "3"}], "+", 
         SqrtBox["3"]}], ")"}]}]},
     {"0", "0", "0", "0", 
      RowBox[{
       FractionBox["1", "6"], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", "3"}], "-", 
         SqrtBox["3"]}], ")"}]}], 
      RowBox[{
       FractionBox["1", "6"], " ", 
       RowBox[{"(", 
        RowBox[{"9", "+", 
         RowBox[{"5", " ", 
          SqrtBox["3"]}]}], ")"}]}]}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.8331097219642057`*^9, 3.833408836591365*^9},
 CellLabel->
  "Out[25]//MatrixForm=",ExpressionUUID->"ad36ff37-6274-464c-8846-\
4404d4f95690"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{961, 864},
WindowMargins->{{Automatic, -1128}, {33, Automatic}},
TaggingRules->{"TryRealOnly" -> False},
FrontEndVersion->"12.1 for Mac OS X x86 (64-bit) (June 19, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"67ce3ed1-864f-4ac4-979a-d39878da5240"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 456, 6, 71, "Section",ExpressionUUID->"b14695c3-84f4-43e2-aeec-40e5aa2c7e44"],
Cell[1039, 30, 518, 12, 51, "Text",ExpressionUUID->"019e6f98-1242-48cf-b104-bcc99ba00625"],
Cell[1560, 44, 2034, 52, 157, "Input",ExpressionUUID->"f736de18-8d23-4497-be34-292099b6b283"],
Cell[3597, 98, 707, 13, 74, "Text",ExpressionUUID->"0567de38-d01a-4628-ab11-d9f3dfbde1ca"],
Cell[4307, 113, 1972, 44, 115, "Input",ExpressionUUID->"8d7b3585-57b4-4620-a4ea-661b47209a83"],
Cell[6282, 159, 602, 11, 51, "Text",ExpressionUUID->"35d57b21-5d0b-408c-a3db-e8f116cbc832"],
Cell[6887, 172, 505, 10, 30, "Input",ExpressionUUID->"8f8fd358-2279-4f0e-a79d-a2a07b5c1b32"],
Cell[7395, 184, 400, 10, 51, "Text",ExpressionUUID->"c6406de8-e728-4cde-87b7-65351aa11fc0"],
Cell[7798, 196, 1002, 18, 73, "Input",ExpressionUUID->"8d44f100-c810-4b4f-b454-6ac6c6126bc6"],
Cell[8803, 216, 613, 11, 51, "Text",ExpressionUUID->"a2074505-58ee-43fb-b7c8-6c807a0eac71"],
Cell[CellGroupData[{
Cell[9441, 231, 2057, 51, 157, "Input",ExpressionUUID->"11d0baaa-711c-49e4-81fb-7a1355e1baf3"],
Cell[11501, 284, 1089, 30, 56, "Output",ExpressionUUID->"93a51eee-b6de-4023-8ffb-c1ba0f3687bc"],
Cell[12593, 316, 204, 3, 34, "Output",ExpressionUUID->"ca6b694c-782d-4324-aca1-babcdffe261a"]
}, Open  ]],
Cell[12812, 322, 273, 4, 51, "Text",ExpressionUUID->"0c0e6b6d-0206-4037-a316-923761877104"],
Cell[CellGroupData[{
Cell[13110, 330, 762, 14, 30, "Input",ExpressionUUID->"6cc598a1-9eb4-4240-b75a-8f13b4a6cce3"],
Cell[13875, 346, 6472, 144, 546, "Output",ExpressionUUID->"c5daa7e8-1367-4e2f-8d67-93d48fa48911"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[20396, 496, 509, 7, 71, "Section",ExpressionUUID->"e3db3499-eea8-4db4-b577-af3791cbd82a"],
Cell[20908, 505, 518, 12, 51, "Text",ExpressionUUID->"d2c16f27-7a39-4153-8c47-cf7bde789b85"],
Cell[21429, 519, 2115, 50, 157, "Input",ExpressionUUID->"f0844fc7-f920-430a-9d72-6786342ada54"],
Cell[23547, 571, 707, 13, 74, "Text",ExpressionUUID->"323d886e-6161-4e48-9460-f8b1272bfbe8"],
Cell[24257, 586, 2025, 46, 115, "Input",ExpressionUUID->"4e113dd1-dcee-4f64-af57-a137b716b7f4"],
Cell[26285, 634, 602, 11, 51, "Text",ExpressionUUID->"59606216-50d9-4859-beb3-955592c98614"],
Cell[26890, 647, 509, 11, 30, "Input",ExpressionUUID->"b2562852-d057-4703-a38a-6999bd692d37"],
Cell[27402, 660, 400, 10, 51, "Text",ExpressionUUID->"8d219f48-6692-4ab9-803b-ad982d32a39d"],
Cell[27805, 672, 1024, 20, 73, "Input",ExpressionUUID->"9341c732-b168-4f03-9b6d-f6457d7adb06"],
Cell[28832, 694, 613, 11, 51, "Text",ExpressionUUID->"cbfb22ff-8b87-4457-ad9a-b32db2b0c6f7"],
Cell[CellGroupData[{
Cell[29470, 709, 2050, 49, 157, "Input",ExpressionUUID->"d657c612-4ff4-4148-a93f-0b4bf1bf3a8d"],
Cell[31523, 760, 657, 17, 34, "Output",ExpressionUUID->"4566257a-f89d-418d-a1f8-2c8a4ba8a192"],
Cell[32183, 779, 208, 4, 34, "Output",ExpressionUUID->"0a12e9d8-2649-48af-983d-8022ffc2e94c"]
}, Open  ]],
Cell[32406, 786, 273, 4, 51, "Text",ExpressionUUID->"7f4ba8ab-b09e-42a0-8beb-1f3ddb709987"],
Cell[CellGroupData[{
Cell[32704, 794, 766, 15, 30, "Input",ExpressionUUID->"3a70a6ed-e719-47f7-9b73-ac7ebc3928db"],
Cell[33473, 811, 14991, 425, 526, "Output",ExpressionUUID->"e32b04e3-de75-41c8-b8c0-dd154a3c0280"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[48513, 1242, 201, 3, 67, "Section",ExpressionUUID->"5460e043-03c7-44eb-aefc-b885896ea875"],
Cell[48717, 1247, 21974, 425, 1811, "Input",ExpressionUUID->"23b63a48-8466-4af0-9bbc-638489299f3f",
 InitializationCell->True],
Cell[70694, 1674, 3097, 64, 320, "Input",ExpressionUUID->"fa0cb441-22b6-4122-a6da-082288353e6b",
 InitializationCell->True],
Cell[73794, 1740, 6763, 160, 824, "Input",ExpressionUUID->"91913ee2-1a6e-4bd5-a927-c172eb40bd62",
 InitializationCell->True],
Cell[80560, 1902, 4918, 120, 614, "Input",ExpressionUUID->"401d215a-b9ad-4b6b-bfc3-de15640adf83",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[85515, 2027, 407, 6, 71, "Section",ExpressionUUID->"0af7d947-a85c-4190-b12f-9a20a68c8a7e"],
Cell[85925, 2035, 416, 12, 51, "Text",ExpressionUUID->"5c2499e8-d5c5-4cd8-a82f-ff7afe8d1b47"],
Cell[86344, 2049, 1614, 40, 94, "Input",ExpressionUUID->"901d8139-e152-44c9-9cd9-d0e9e9a2b6fd"],
Cell[87961, 2091, 341, 9, 51, "Text",ExpressionUUID->"5cf28579-a30c-472a-9699-5b9c1e796319"],
Cell[88305, 2102, 541, 13, 52, "Input",ExpressionUUID->"fae748a2-7f69-4a23-b949-c10348e04a24"],
Cell[88849, 2117, 707, 13, 74, "Text",ExpressionUUID->"8cb4572a-884a-43f2-95bd-54e25c022354"],
Cell[89559, 2132, 1409, 27, 52, "Input",ExpressionUUID->"d0cad91f-5269-4b3c-83ae-58b242f94a74"],
Cell[90971, 2161, 602, 11, 51, "Text",ExpressionUUID->"c1a047d5-9807-4c91-bf92-47c609cb2229"],
Cell[91576, 2174, 505, 10, 30, "Input",ExpressionUUID->"ad199950-42e6-450e-97ad-08852d09b5f5"],
Cell[92084, 2186, 400, 10, 51, "Text",ExpressionUUID->"9a713d86-c70a-441d-8928-092425d411ae"],
Cell[92487, 2198, 864, 15, 52, "Input",ExpressionUUID->"062ae511-1207-4c86-a7ec-4c8b63b0024b"],
Cell[93354, 2215, 740, 13, 74, "Text",ExpressionUUID->"677384d1-d4f1-4781-9c53-a93e000cf670"],
Cell[CellGroupData[{
Cell[94119, 2232, 1342, 27, 94, "Input",ExpressionUUID->"e97e886c-357f-4074-9f8b-17135c0cef7e"],
Cell[95464, 2261, 496, 11, 34, "Output",ExpressionUUID->"86635202-db5a-40fb-9058-6383ef4fb09a"],
Cell[95963, 2274, 3337, 116, 200, "Output",ExpressionUUID->"89a4b81b-7809-4c99-aaae-5e95077b83f6"]
}, Open  ]],
Cell[99315, 2393, 273, 4, 51, "Text",ExpressionUUID->"4f1f3999-3a7b-4679-9dda-6cf053500ee1"],
Cell[CellGroupData[{
Cell[99613, 2401, 851, 16, 52, "Input",ExpressionUUID->"8fd4dfe0-3432-4974-a5b8-8932efcb4d44"],
Cell[100467, 2419, 1510, 49, 162, "Output",ExpressionUUID->"ad36ff37-6274-464c-8846-4404d4f95690"]
}, Open  ]]
}, Open  ]]
}
]
*)

